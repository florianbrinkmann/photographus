language: php
php:
  - '7.1'
addons:
  ssh_known_hosts:
  - "$STAGING_SERVER"
  - "$PRODUCTION_SERVER"
before_script:
- echo -e "Host $STAGING_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- echo -e "Host $PRODUCTION_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
script:
- chmod +x ./scripts/deploy-production.sh
- chmod +x ./scripts/deploy-staging.sh
before_deploy:
- openssl aes-256-cbc -K $encrypted_2b0f3b697a2c_key -iv $encrypted_2b0f3b697a2c_iv -in deploy_rsa.enc -out
  /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
- npm install --silent
- npm install -g gulp-cli
- gulp production
- mkdir -p photographus
- rsync -rav --exclude-from='.rsync-exclude' --delete-excluded ./ photographus
- zip -r photographus.zip photographus/
- rm -rf photographus
deploy:
- provider: releases
  skip_cleanup: true
  api_key:
    secure: q4HnsOAxs/otO6Yj/ziq+ofcSmnMELujrGIelzGZJr0trNq3jb3XR/opuChDKBy0Ldc7ZEg7OOSp+emXkOmIV04XvX4+5L5pEnQOkZ+g0+GGPGWyuMoL+aRNnuAQtQk/wLh6+vvfhHHET8E3C8+RvlZi94SNdFm7Z/aCcQgfyKKv1G44en/zZs0Qd8o3TfvS5wVknhZwPo/lzwdiDr5/0aEPJsZ23NbnVGwB7FOovpMy4OVCKyCZhEDLTqlfptkix1Chv2iz4kBzxoPYleOaKcoEAyaiGz/XlsZYnIPI9BT83bqjnbqfZY08ycE4hWUFUHF56XrYUr00ZGUb3GtwRtbpNqK6P6Qd+gw3VenWWZExgwNR3mceLmDNAeUNBkKezUmdiQiioerG/GzEuobWZhtSY3qv99YznbhfabdIoYi4LzCKzVRAw/ZzpMQ20qHAzPNdHII5nl1tBm3TWlQL5EpxrB+1nVixvKnOnC0bUMYEo52Gb+WcL2cNTpCe8jSzmbSWpAtgzQpRkVZSPmBNcvaiHziltzbija7nRvK9jmWh1H58p+Tlvq0I4fSSLeASQFj9VZAoD9qkkj7Nep0JvMZ7NzpGcjmY90JqkTElIW5K0tQbjUbHXIQgsnO/soiMxDbUJxJVUo+qNO7vOE6NA5vkEzoKjky2ttHbXW+jy/4=
  file: photographus.zip
  on:
    repo: FlorianBrinkmann/photographus
    tags: true
- provider: script
  skip_cleanup: true
  script: ./scripts/deploy-staging.sh
  on:
    branch: master
- provider: script
  skip_cleanup: true
  script: ./scripts/deploy-production.sh
  on:
    tags: true
env:
  global:
  - secure: fzCmnX4QidvdjF8P5ikuhqclHUCDNjJNzRWTU0rDqw9sVgoxQnxy7+rD58JRzz8OrM9KXHLubyYbrCYmDytjijYk4wbBS3cyb3KY3P8FB16VHLvvQH+3JXRo3aqBreYUY+sUCBFyYMYaa21/Gq4smXNL7cvnQiAZmJYHHEELhnhglNoHv5KpsbUHzvHfDsChEfAjqWwRAbnWtsyQ+yS2h8kzwfeOb8b7TlSCvHpg/xMwAL8KppRdQMwfXDhcZs35GSxCvSEMrdJg9uMbfoIfpKk3n8LXQE/63p/M+31wTdNaS6yZZzOSCGQk06VeiWVubi1fQR/JxPKN+T45l3x1pCd8o+vjMYH1yaH9Db2aq/f6QB21biYiY2WesqPqejiizdT34MXITwwdpi4eF1I2jD/a0NfjnZpdXGPpkYMI8x3yU+RNnUa7OfJWcG89o2Yw/7hSIeBz6X9rXDGst4YT+tTJEWz5BrniyJoY0Zj+Q2BUX92/M5D0uOpvDPBZkI/Lly5IUwl1BY5bLkq3lEhlhJz3O2MzcvQISFAbHq89NnUV2Ek628dkBTGiPAPrrjeE0Cbj5hgAETmeZ/e5BOFhLjctKkv/wQNNag8ipPYaRH7qKdP/MUPKBpdf5vNDJ7cNeKfIsuxjNurEJL/kWatOnOVtDLeBK26KccTA4e0xEVc=
  - secure: NOfCSypYhh7ZZYYFw0tTYTF3ycXJW7Aq++ti2F/XN9AqYEwnvVThzP85Uqi/02KuF8uF9nW5QPEUFxeQr1d9Yr5ue+6uPsgdKoZVbzOcAcam45I3GfDWCMBzL7QQCtU3/Uz3K/AcDUrjpWMLioOpaWpqKYg3XqPEVG0h7VCwcqp7DM6tJlaLhU2l0SLYSTTGPw8IvaRBsh1xhZiAolvtmQqGVWnjzwHqBRF5PZKsbE4BW7ZODDgFoZIp1lCCxJsUjpdt7nYFT3QO25hRXFCK46Rdm3naqfSqwKJY3iObSUBs/ACGURT6DJkkepLErWxhHb6VZtpz2e2c+9Zw/4gYdZxMjQjGmveYIpuT2R69J9W1GLTnPNn6tvikbkV9DjQoiaF1370ircXiuXUA9pf7NqO79kAUO72SfyyHNf5gWoJTlA876nocViYc9YPS0eo/+B19cUFiGt7X2LdNIDK/m4YAJmz6/lVliS/YnswY+CqA5QugzZpbk7QTkkQ04xTE103pe04OoU/eI3wR3e7p2CVU1B9P1WpVjtJbuDiwmc+Ap95+qDndXwvN06oVZixc5MIEnLgQqyw/HajgPxfGLYqCo0kYj6F+14MZ22kDKuYP7jq7bUvTLKexlzaCYMd0HRmxU5rKxhSgDufUSDZceyfQMgYLuNiBA6rNB6CZ2fA=
  - secure: 1RqIbOjRozl1DB49ieaT1THLrrP/R0iGr901B4pvoNQUNa+OxiZeCgKRSQ+PrN1cFvFl9n4detlHYJuXnvHJETrrWoQwjIb5Q436/cY4S3k8QNRiQ1vF4NVT4fwlBFNEn6cbTOwm+OvZC6Foah0rIDXgYGyJWh8/GQPRBWW0n6zvHbGULfW0+pyU/RjYtJ1goUI0RqwUcNA4GmqVd0F1r67BGPvY/InyQ9ZWFXha3B4UzCLEqZGykuLl5ffY9x51EhkbxlvPFvvO1qX8MatJhRBz8axILoYcLDD4ZCWRJG1fFubc6Mit+cGFaq6xb/aNgnhijHEU5RyVxqm/aDUKI4ozJ6zhdj4skcdi8mnD7rDv3zZeg5aLwHj67dCKm+PWPYayZTobltYaVmAr8MK94sY+dPnKUUjF55AKEQE8kjr9VDoSse+9wUoA7IaOXtBZ8VXD1lt5UCFbWsb687V/TuyjytkJkP74KIDQienTmg+m0bO9Gzq92N05zjusReIE4C4PuOkDEyvtvGkR9QAENWMh1SyGvsl6+IT2k/OpMmWtbd5yiDZ5xIHjZ1wc0aTmmy0E0NP6LZUboRwEiQQvObTCQ6UlscgaySpBgoHNPyXp+lV1TwlA9azhNd6HCGg/IjqHFSZkFATndZvf9HAb7zzTptCmunGDWBIiVP8RT6w=
  - secure: 45eWsupRxjx5VkgbmLFJ18KNPhETXEFSBh9V7SxnkMcyJpO2pzOCOKP5ImAhDFd++K8f7u9N8Oq2OG2qjtKECnasPbbjHFDdiffREUZ0SQnKXLkuwl60jlgoAdSuL90sQ6UDQPoq6QpCj+UUKcOPkAi0C3kkYQqc4fuJbYdH5NIqQV4aEBXm8Mhppwb0WNvB5CwrSVW8SKvjJDuOY3LTbfwrKHSlev4lQmYqG34+HHHoG1Grjbwp775vMto6LEM98GfatDv9Axs7N+2BHyvfuOYyGEdvVFd9r04/H0nQLZXjjwW95jD1wLX92FDKoKH3MZa28N58KjwmTF20DmW9LDLM/ltt64YYZpTGah0boBSHTX47+EqMotHZWD0HT9CmSuu7LYblWNvY0ZhJ9qjEmQ5SW1NGqWSzQtVPbCELU3EYkihOSWNtkOd7tl7pvmZMV+VdcGsDotyO1DUfA7+gNypEoVr4ocNZ4e0+4qnFWmcmjz4PIb/CMpUI/MpSjcBJwJqZPDQmYe85ZvG7iqnwZhU5M2Y23XcyncwLt45Av5Ho6d17w+0QyVXHVlWWuEHnahaxzzgGdeFxKjLlz1wNTrLIojzJ1KI3hjRuzF0f4e7cilXNduhnH5FcHWG7pI6luXA0ZENDGVj6DHNf4eieocDz04jCsqHAL/8WDVFAXfI=
  - secure: wYyEtdfc4NMUTrUsLGshtOlAGHMt2Z60h0hyLN9wVMVMQ8msu6ulVoEyT1HH1LNSKz8bGNu8XPYuLdFtbbKwgeAMpHocBJy9MM9eA99g+Lq4hQsXl3OoiJBbKIxfPmatWJ66Dy9mXrSEsSgZPldXSw9GCXVlUl36MxDZSvfBVI8JIfy/7H7G5HzuJ25IZplT4h7LeWhAfKakNtnN7Fc8pU7HyAuXHJ1paXK86LFdWwCZ/bpsXqOeS2etg4jbwdoyvYd5RHbBh49M467tQThj+tonGfvZ7Q69Bt+l4rccoPbByLmbZxQfZ63oEY+G0D30kVC44sl9wgv4YhqwLWFk273xKq9AxzR5bM62fZ99XigZMQsz/cyBLfMFtVvbdrd14utZ4uBBJc7YbhKl1BgFpt81hAPeODhzhvlxpvrp3llB31fy5QMl41SERO3AxM99zUJVEjSbFhTqqoSP5ApOEoy5w2JGzdUydH0nGcIsEVpZ/edE/bXBFHMG+Lwtwkg0wRkFhFiIm4T56dS5ReNc6Et12iZ8q3MLAlXF+uaZeOmGHsHfxBadryriwYXXsrtWMpwhPo0vqOy+4HZvxEp/tXxLIfXpuqnw3FNfOavrbw4awPf0PI+HkctD6n+cH1sN99kGGM2sNlA2LO+JPzkAOoy5aRFhpVom4CW7RsDR2uI=
  - secure: nAcqij9An1XfnsGZLToD2MQFYCMal5BMOMfU3xAOHsCjrJz3h1tSRwP1OdWKmEmMaGGI/g3zkgzM0wxXYd+Ft1Yg7vIri68UECOnRyxZVXGaEoodtSM5UxvUskRwDjnm0M/BpMfk/Q5CBbdi0MxIkW36XZShxd/RobzNf7IkuSA3lpL5IU2Ii2T58S/b9PdvXrUqATE+/mrjGdmZypudCblaPnzNEaHH3MVVnCjzpDDUVwf2Qd84ozhD6cb8IvuoZHFWdlU7k+G4S2rgzOem1L99k+EBpNhmApYPBUpt7cXCtbNYHfe6NT2JrJgwb0aKGXyQvlVgQ/zgL8v24UkZwMxIDvw6DuCzwCGX3iLysOk3Qja4SQmTw3IPlkHIm0/JAP27/v9KFHBLUQSuIuyae+kI5ToPamNtMvJ6YCBYPevhlSv2J8G7aGYIrlpPYLWajKmdX3jMcEPUpE8UcKSQhHr+2pX6SWWlzkTroioEIoKKdqoh1eWWSAYO+FZh22eUoW1G7T1w2HmY/BZlHapK1R3wlB+Tmwb4GAqwXhhZ/eMPrzeK0SBxQas5R1Flq0VrsSQ/D37A5tQxL1p6DN+t7imSkyfA+vE7avsjJ7N7cJqkn0Q++xMp5DO+FRBfTc7c2VcYajxpCoHrLAW1BGR0Z5lQKtY6xAH+QpMFCvSCw88=
  - secure: qpgibtG2P3pXXHACwTtCIDnRT4UeLjaYWL9tOvwFR8qexRe8ktdfbOF3xpWdPp+KaTz0K5SfodLn9AceDRz6Kv1hqBmXf9XbpvpiNHxifT6J38Xn08c7N3Fbwa0LJPZ/+EvcQgd+DedrFjHigBF2aWYHvfLp5UPXvmvuOCOgtfMVMJiOxRDNq+/Ju4Te9x7ICc5fcIdQ/EqS/sykFrlGxa+KeA+2Fp4prWpfDpo/4kZWTymFJrzIqY/qlcnsJYBvK72e2dyjLrxppaPp6tCcm9Y/2s+V6LznqTuRAqCV960M2QFe640DhcRH0zJMaFUdd70PH3OROchn4moaMEPiunbiapchD10pye+m+LGqzghb7llXkgnnKeJMkqZx8rfCGXxraXJUuoK82K6ArBIYdIV1M+ZsKPvJecpuhnJj6ixN8s/tbG10OYRBC/v/zCH/vlj/BtEITXOvT92FQrpTrEQtPrsHASes9uZXG6fNOTrwuXvVizc8bbufA0S6hHZHoJIzUh7HfRVKFU3LMRtOlKQ9iI3yOcYx3XHXXynr6VCytiKnQXvONLGlkeFloXqdxcMiDhz0PZCKYo7605RYWdV3lRWWHZ2XZXS5oCYKZlmeorLQQqHHFFabXmxvAEW6UBNdZ+wHyfNRc5xIK9YANEdFqj3EAc2zf704zF9YiME=
  - secure: OR2HvYvwPb+5L9N5U6znLpBFZfpESDMR9FoRbaWxV/WA7sO2waE0hJPgkjBFIDxIbI5S9UDyI2b3xFS2jDFWzAOQqgltStr/4HDGZ+qz1LYKMkWckhQN4cSGdWlk0/8R8/pEeXRKzKgoiZVOI6SBjBuNiZZjrSwWmmB60Q7XPWQ8O8VAtQiJnQdswWIJx6odo7QljyDOug/Ox0edGWuBEwI/dFRCbPquUw4BjwzNdRmUisB0sAArUt2pCTU2eZkJG5AsmAlnSRoFU9GDg5uULR+P8v0jYs9AMAJ7/kV/H37tS0nspM2FxHGcq5DLfXLiSF2PpVQyV7u2Kxqsbp0uWEvXWDe5x+0YzA2Jim8X+9fsbCE3evsaPV+tR1cKkJx0crgybwQSMVituaahivA+R6XTBtYqQJSnRUdBCO8XhQNUs/wbjjDzpwDj0JoAWTWvr0azMaIo+Vq2UQaUDzE1nlhHknA2Lxdmah8EQBOm6uRcPfApXWj7wWEepNya3a3/wgw2xtdzsFR4F7fz4lg89wUlzTDKmfU60fCtbFEI6YYEv2MMjLionT+0XFYcXf0qz8P0mJPobwXGxbZKC6Wijup/f6eZwP1QDc+aAimXCfueAbIqYCSaj9/oqXduTOGhdH0yH4dP9u8F2CiCmvahHYvpW6eG3S1A4+81eOclx5k=
  - secure: QrV9hL+7T6sQ1lOTisJnahOXeZ9w3/Oppr47SRYLz/7oY4r+0lmMSMxlKYNRmOh3Bk22tRw9nBxB9/1O2rlAwUsH7ygkMxAHGeeunajct3pKQXjk/h5TZHjH836aW2gQ9sR12URDQJWHtr8oLLfA2Y+XGxJzWgGOmFaynTpQThdi87TZIPdph8CuHV+jz/+AmfvLKtTU8AQlnskLkdOwEn73+2+HxQ5Z371EpIWp9T14NKqC3/5WOkIz1tYKgDznXYREwKNLKqwK6WD0DGQunUrOMWJ+qGXcLcBBpXJtLtI+mG44VDQj8H86c/1fllCmGMGZHmf3J6XnhGYHvpxphP4q3l7NkgRBo7VInhD6IQEtH3Vlk2Q5WOZtyxrflTstoFYeezCnZILTHNL4SOHbnHF5EylM6VWOhV0EPCLvEEBquNxVPwy0jBFGh4P7Wl1rSpNy7CFdrzXghEBPbdzssihadM3Q1Z5fHBCI1eDfdqreq9uCOnW/eTzINsvomLhAhSUJG9V3y394w31fdRMcuV2iKrucjLLfctUmfD2ysn8FBed2QQjgXuljo/QA325mXQjJxw7V+YXYCxN2lxqwAfqmRxHaiMcm2GKrfI3NmHUH6m9wffbjz8UpbS3hntJuDw2TBFZk0ozhL9hEQIoMBbtsviNqsyqpnx7Xe6AfqtY=
  - secure: CXEtBAaF6ukuFyi/YdVZiRSetxIWR5koRnhTUa3FaUyY57hlO8KCXK14PxHaWxbMRAazZDcslYzTbt68ZozGhgXHdbgSXa6HmAVZAX1nTH4AYrDJ+tPSSDTm6dh9HetklVMbaFNzNWGxqBvNYsUcIKLhmFFBIuCxKryC1uMy1rSqPlWXHnwXaHrFgRqSoAy/bves2LMTPNjHW68FrhocK06gtLBbWBBMOHTZF3hsjCMmkmAhptdLHCrL2rJRS+5FzUm9lx6lBF8tvtQ8VmsZnzMwzAyEeN/U/zlXputlB++/5qhFu+KwuGoGV58VkPctOhE/MbfUdIiyJTevrc9mADGDpsV7OiDfRllRJP8a/Axe8mIeHHC5eL8kCv0zk2/o8molQc/BwW9/A6GwTzrpY2iJdaXxKLra/2KqezXJKRA4x+4Cr/I6OklF73Xy5fCDfnJmhzhaE95IHmQDGfMNIIahST1HQ3I+qYXjkEfAzL3quifgs/jjqVcH737rAgIBBZwQQwtzC4yQAA9t2v0luoD3YhwshvCywJ7nUxrFO8Sv1tpPIvB0BWI2/BySOZ0oopMZLLe67iTGI3hRmMd5/iSwdFL95AeZd1OkREboscuPSQuJ+NBN7rg8f0U4AxZmgmhzOWWEr/h0Rl73LcJOMcL9hWQTRR/gvgNGBymbNxQ=
  - secure: jKy0sSMygBo+/1GGKFgKrQCxU83vDnL9k2bYG92COWXyH9tkywBTpViExHrQRK4FmIPLleIBFUVKDrPcnRSAninsacYYBvrs2KtdtvxZ31bYR0eD1EJVJuwXZHNqF7FSYU8oU+1Bc0lryMalcevLd5EZaFBU1B9Nz4PrYEKOzavTGbmYvJdwkGs8bo4uyoSdI6FVCI0L9vcaZbtO1D1V8Tgdn8TLrVpqKf/K3hCobroCoK2CQGGgBKurS5FeYBpWSCO35ptaEAlOcMsCNhgWSnQr6nzDictrzso+DQ5R+Vd2LKO/jeiYOEgbd8k5OfjxAAR5O3lJbV8yuiVLV6vPq2agAp9QVzl4FGrdJAeYZMoHhnQd/Qv2ZOrvl6rvECMqh5+bSbShuSz9a8vY7Y+8038RujUqPoXBeN1oEQUwMZ7c5ncOhMDMk2gO67lDtyW732TSowfUpJAjKUfntD/sYqtg4ubrR/usk4quSNmSz1gBIVCTHfvwgQx6k5FiSRe+Hmx6kCe32bIdNRETkDQMqbdpiwT9dX9sBDAO3SVkMUeMjwq9GXZB/W2LwlTapQvaf7LNQOtn0MaNgm9VpRkhXBO7hTnwkeU5FUEMQRJyNBoIWTs0ajpADtdcU1GqGoGAqnMM4c9SQLPSp5o/Hwnxj5HZb4oDaO7DnXQggdiIjtw=
